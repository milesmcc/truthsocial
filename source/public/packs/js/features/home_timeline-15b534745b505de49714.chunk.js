(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{845:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return se}));var a,o,i,s,r=n(0),c=n(5),u=n(1),l=n.n(u),d=n(9),m=n(20),p=n(810),h=n(205),g=n(202),f=n(123),v=n(3),b=n(809),j=Object(v.g)(a=function(e){function t(){return e.apply(this,arguments)||this}return Object(c.a)(t,e),t.prototype.render=function(){var e=this.props,t=e.settings,n=e.onChange;return Object(r.a)("div",{},void 0,Object(r.a)("span",{className:"column-settings__section"},void 0,Object(r.a)(v.b,{id:"home.column_settings.basic",defaultMessage:"Basic"})),Object(r.a)("div",{className:"column-settings__row"},void 0,Object(r.a)(b.a,{prefix:"home_timeline",settings:t,settingPath:["shows","reblog"],onChange:n,label:Object(r.a)(v.b,{id:"home.column_settings.show_reblogs",defaultMessage:"Show boosts"})})),Object(r.a)("div",{className:"column-settings__row"},void 0,Object(r.a)(b.a,{prefix:"home_timeline",settings:t,settingPath:["shows","reply"],onChange:n,label:Object(r.a)(v.b,{id:"home.column_settings.show_replies",defaultMessage:"Show replies"})})))},t}(l.a.PureComponent))||a,O=n(45),_=Object(d.connect)((function(e){return{settings:e.getIn(["settings","home"])}}),(function(e){return{onChange(t,n){e(Object(O.c)(["home"].concat(t),n))},onSave(){e(Object(O.d)())}}}))(j),y=n(134),M=n(42),R=n(17),k=n(147),C=n.n(k),x=n(16),w=n.n(x),A=n(2),I=n.n(A),q=n(19),S=n(13),N=n(7),P=n(212),L=n(92),E=n.n(L),D=n(12),z=n.n(D),T=n(369),F=n(95),H=n(331),Y=n.n(H),U=n(25),K=n.n(U),B=n(73),J=Object(v.f)({close:{id:"lightbox.close",defaultMessage:"Close"},previous:{id:"lightbox.previous",defaultMessage:"Previous"},next:{id:"lightbox.next",defaultMessage:"Next"}}),W=function(e){function t(){for(var t,n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return(t=e.call.apply(e,[this].concat(a))||this).setRef=function(e){t.node=e},t.onMentionClick=function(e,n){!t.context.router||0!==n.button||n.ctrlKey||n.metaKey||(n.preventDefault(),t.context.router.history.push("/accounts/"+e.get("id")))},t.onHashtagClick=function(e,n){e=e.replace(/^#/,""),!t.context.router||0!==n.button||n.ctrlKey||n.metaKey||(n.preventDefault(),t.context.router.history.push("/timelines/tag/"+e))},t.onStatusClick=function(e,n){!t.context.router||0!==n.button||n.ctrlKey||n.metaKey||(n.preventDefault(),t.context.router.history.push("/statuses/"+e.get("id")))},t.handleMouseEnter=function(e){var t=e.currentTarget;if(!N.a)for(var n=t.querySelectorAll(".custom-emoji"),a=0;a<n.length;a++){var o=n[a];o.src=o.getAttribute("data-original")}},t.handleMouseLeave=function(e){var t=e.currentTarget;if(!N.a)for(var n=t.querySelectorAll(".custom-emoji"),a=0;a<n.length;a++){var o=n[a];o.src=o.getAttribute("data-static")}},t}Object(c.a)(t,e);var n=t.prototype;return n.componentDidMount=function(){this._updateLinks()},n.componentDidUpdate=function(){this._updateLinks()},n._updateLinks=function(){var e=this,t=this.node;if(t)for(var n=t.querySelectorAll("a"),a=function(){var t=n[o];if(t.classList.contains("status-link"))return"continue";t.classList.add("status-link");var a=e.props.announcement.get("mentions").find((function(e){return t.href===e.get("url")}));if(a)t.addEventListener("click",e.onMentionClick.bind(e,a),!1),t.setAttribute("title",a.get("acct"));else if("#"===t.textContent[0]||t.previousSibling&&t.previousSibling.textContent&&"#"===t.previousSibling.textContent[t.previousSibling.textContent.length-1])t.addEventListener("click",e.onHashtagClick.bind(e,t.text),!1);else{var i=e.props.announcement.get("statuses").find((function(e){return t.href===e.get("url")}));i&&t.addEventListener("click",e.onStatusClick.bind(e,i),!1),t.setAttribute("title",t.href),t.classList.add("unhandled-link")}t.setAttribute("target","_blank"),t.setAttribute("rel","noopener noreferrer")},o=0;o<n.length;++o)a()},n.render=function(){var e=this.props.announcement;return l.a.createElement("div",{className:"announcements__item__content translate",ref:this.setRef,dangerouslySetInnerHTML:{__html:e.get("contentHtml")},onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave})},t}(R.a);W.contextTypes={router:I.a.object},W.propTypes={announcement:w.a.map.isRequired};var G=function(e){function t(){return e.apply(this,arguments)||this}return Object(c.a)(t,e),t.prototype.render=function(){var e=this.props,t=e.emoji,n=e.emojiMap,a=e.hovered;if(E.a[t]){var o=E.a[this.props.emoji],i=o.filename,s=o.shortCode,c=s?":"+s+":":"";return Object(r.a)("img",{draggable:"false",className:"emojione",alt:t,title:c,src:B.a+"/emoji/"+i+".svg"})}if(n.get(t)){var u=N.a||a?n.getIn([t,"url"]):n.getIn([t,"static_url"]),l=":"+t+":";return Object(r.a)("img",{draggable:"false",className:"emojione custom-emoji",alt:l,title:l,src:u})}return null},t}(l.a.PureComponent),Q=function(e){function t(){for(var t,n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return(t=e.call.apply(e,[this].concat(a))||this).state={hovered:!1},t.handleClick=function(){var e=t.props,n=e.reaction,a=e.announcementId,o=e.addReaction,i=e.removeReaction;n.get("me")?i(a,n.get("name")):o(a,n.get("name"))},t.handleMouseEnter=function(){return t.setState({hovered:!0})},t.handleMouseLeave=function(){return t.setState({hovered:!1})},t}return Object(c.a)(t,e),t.prototype.render=function(){var e=this.props.reaction,t=e.get("name");return E.a[t]&&(t=E.a[t].shortCode),Object(r.a)("button",{className:z()("reactions-bar__item",{active:e.get("me")}),onClick:this.handleClick,onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,title:":"+t+":",style:this.props.style},void 0,Object(r.a)("span",{className:"reactions-bar__item__emoji"},void 0,Object(r.a)(G,{hovered:this.state.hovered,emoji:e.get("name"),emojiMap:this.props.emojiMap})),Object(r.a)("span",{className:"reactions-bar__item__count"},void 0,Object(r.a)(F.a,{value:e.get("count")})))},t}(R.a);Q.propTypes={announcementId:I.a.string.isRequired,reaction:w.a.map.isRequired,addReaction:I.a.func.isRequired,removeReaction:I.a.func.isRequired,emojiMap:w.a.map.isRequired,style:I.a.object};var V=function(e){function t(){for(var t,n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return(t=e.call.apply(e,[this].concat(a))||this).handleEmojiPick=function(e){var n=t.props;(0,n.addReaction)(n.announcementId,e.native.replace(/:/g,""))},t}Object(c.a)(t,e);var n=t.prototype;return n.willEnter=function(){return{scale:N.n?1:0}},n.willLeave=function(){return{scale:N.n?0:K()(0,{stiffness:170,damping:26})}},n.render=function(){var e=this,t=this.props.reactions.filter((function(e){return e.get("count")>0})),n=t.map((function(e){return{key:e.get("name"),data:e,style:{scale:N.n?1:K()(1,{stiffness:150,damping:13})}}})).toArray();return Object(r.a)(Y.a,{styles:n,willEnter:this.willEnter,willLeave:this.willLeave},void 0,(function(n){return Object(r.a)("div",{className:z()("reactions-bar",{"reactions-bar--empty":t.isEmpty()})},void 0,n.map((function(t){var n=t.key,a=t.data,o=t.style;return Object(r.a)(Q,{reaction:a,style:{transform:"scale("+o.scale+")",position:o.scale<.5?"absolute":"static"},announcementId:e.props.announcementId,addReaction:e.props.addReaction,removeReaction:e.props.removeReaction,emojiMap:e.props.emojiMap},n)})),t.size<8&&Object(r.a)(T.a,{onPickEmoji:e.handleEmojiPick,button:Object(r.a)(S.a,{id:"plus"})}))}))},t}(R.a);V.propTypes={announcementId:I.a.string.isRequired,reactions:w.a.list.isRequired,addReaction:I.a.func.isRequired,removeReaction:I.a.func.isRequired,emojiMap:w.a.map.isRequired};var X=function(e){function t(){for(var t,n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return(t=e.call.apply(e,[this].concat(a))||this).state={unread:!t.props.announcement.get("read")},t}Object(c.a)(t,e);var n=t.prototype;return n.componentDidUpdate=function(){var e=this.props,t=e.selected,n=e.announcement;t||this.state.unread===!n.get("read")||this.setState({unread:!n.get("read")})},n.render=function(){var e=this.props.announcement,t=this.state.unread,n=e.get("starts_at")&&new Date(e.get("starts_at")),a=e.get("ends_at")&&new Date(e.get("ends_at")),o=new Date,i=n&&a,s=i&&n.getFullYear()===a.getFullYear()&&a.getFullYear()===o.getFullYear(),c=i&&n.getDate()===a.getDate()&&n.getMonth()===a.getMonth()&&n.getFullYear()===a.getFullYear(),u=e.get("all_day");return Object(r.a)("div",{className:"announcements__item"},void 0,Object(r.a)("strong",{className:"announcements__item__range"},void 0,Object(r.a)(v.b,{id:"announcement.announcement",defaultMessage:"Announcement"}),i&&Object(r.a)("span",{},void 0," Â· ",Object(r.a)(v.a,{value:n,hour12:!1,year:s||n.getFullYear()===o.getFullYear()?void 0:"numeric",month:"short",day:"2-digit",hour:u?void 0:"2-digit",minute:u?void 0:"2-digit"})," - ",Object(r.a)(v.a,{value:a,hour12:!1,year:s||a.getFullYear()===o.getFullYear()?void 0:"numeric",month:c?void 0:"short",day:c?void 0:"2-digit",hour:u?void 0:"2-digit",minute:u?void 0:"2-digit"}))),Object(r.a)(W,{announcement:e}),Object(r.a)(V,{reactions:e.get("reactions"),announcementId:e.get("id"),addReaction:this.props.addReaction,removeReaction:this.props.removeReaction,emojiMap:this.props.emojiMap}),t&&Object(r.a)("span",{className:"announcements__item__unread"}))},t}(R.a);X.propTypes={announcement:w.a.map.isRequired,emojiMap:w.a.map.isRequired,addReaction:I.a.func.isRequired,removeReaction:I.a.func.isRequired,intl:I.a.object.isRequired,selected:I.a.bool};var Z,$=Object(v.g)((s=i=function(e){function t(){for(var t,n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return(t=e.call.apply(e,[this].concat(a))||this).state={index:0},t.handleChangeIndex=function(e){t.setState({index:e%t.props.announcements.size})},t.handleNextClick=function(){t.setState({index:(t.state.index+1)%t.props.announcements.size})},t.handlePrevClick=function(){t.setState({index:(t.props.announcements.size+t.state.index-1)%t.props.announcements.size})},t}Object(c.a)(t,e),t.getDerivedStateFromProps=function(e,t){return e.announcements.size>0&&t.index>=e.announcements.size?{index:e.announcements.size-1}:null};var n=t.prototype;return n.componentDidMount=function(){this._markAnnouncementAsRead()},n.componentDidUpdate=function(){this._markAnnouncementAsRead()},n._markAnnouncementAsRead=function(){var e=this.props,t=e.dismissAnnouncement,n=e.announcements,a=this.state.index,o=n.get(n.size-1-a);o.get("read")||t(o.get("id"))},n.render=function(){var e=this,t=this.props,n=t.announcements,a=t.intl,o=this.state.index;return n.isEmpty()?null:Object(r.a)("div",{className:"announcements"},void 0,Object(r.a)("img",{className:"announcements__mastodon",alt:"",draggable:"false",src:N.l||P.default}),Object(r.a)("div",{className:"announcements__container"},void 0,Object(r.a)(C.a,{animateHeight:!N.n,adjustHeight:N.n,index:o,onChangeIndex:this.handleChangeIndex},void 0,n.map((function(t,n){return Object(r.a)(X,{announcement:t,emojiMap:e.props.emojiMap,addReaction:e.props.addReaction,removeReaction:e.props.removeReaction,intl:a,selected:o===n,disabled:N.f},t.get("id"))})).reverse()),n.size>1&&Object(r.a)("div",{className:"announcements__pagination"},void 0,Object(r.a)(q.a,{disabled:1===n.size,title:a.formatMessage(J.previous),icon:"chevron-left",onClick:this.handlePrevClick,size:13}),Object(r.a)("span",{},void 0,o+1," / ",n.size),Object(r.a)(q.a,{disabled:1===n.size,title:a.formatMessage(J.next),icon:"chevron-right",onClick:this.handleNextClick,size:13}))))},t}(R.a),i.propTypes={announcements:w.a.list,emojiMap:w.a.map.isRequired,dismissAnnouncement:I.a.func.isRequired,addReaction:I.a.func.isRequired,removeReaction:I.a.func.isRequired,intl:I.a.object.isRequired},o=s))||o,ee=n(58),te=n(4),ne=Object(ee.a)([function(e){return e.get("custom_emojis")}],(function(e){return e.reduce((function(e,t){return e.set(t.get("shortcode"),t)}),Object(te.Map)())})),ae=Object(d.connect)((function(e){return{announcements:e.getIn(["announcements","items"]),emojiMap:ne(e)}}),(function(e){return{dismissAnnouncement:function(t){return e(Object(M.o)(t))},addReaction:function(t,n){return e(Object(M.m)(t,n))},removeReaction:function(t,n){return e(Object(M.q)(t,n))}}}))($),oe=n(148),ie=Object(v.f)({title:{id:"column.home",defaultMessage:"Home"},show_announcements:{id:"home.show_announcements",defaultMessage:"Show announcements"},hide_announcements:{id:"home.hide_announcements",defaultMessage:"Hide announcements"}}),se=Object(d.connect)((function(e){return{hasUnread:e.getIn(["timelines","home","unread"])>0,isPartial:e.getIn(["timelines","home","isPartial"]),hasAnnouncements:!e.getIn(["announcements","items"]).isEmpty(),unreadAnnouncements:e.getIn(["announcements","items"]).count((function(e){return!e.get("read")})),showAnnouncements:e.getIn(["announcements","show"])}}))(Z=Object(v.g)(Z=function(e){function t(){for(var t,n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return(t=e.call.apply(e,[this].concat(a))||this).handlePin=function(){var e=t.props,n=e.columnId,a=e.dispatch;a(n?Object(f.h)(n):Object(f.e)("HOME",{}))},t.handleMove=function(e){var n=t.props,a=n.columnId;(0,n.dispatch)(Object(f.g)(a,e))},t.handleHeaderClick=function(){t.column.scrollTop()},t.setRef=function(e){t.column=e},t.handleLoadMore=function(e){t.props.dispatch(Object(m.u)({maxId:e}))},t.handleToggleAnnouncementsClick=function(e){e.stopPropagation(),t.props.dispatch(Object(M.r)())},t}Object(c.a)(t,e);var n=t.prototype;return n.componentDidMount=function(){var e=this;setTimeout((function(){return e.props.dispatch(Object(M.p)())}),700),this._checkIfReloadNeeded(!1,this.props.isPartial)},n.componentDidUpdate=function(e){this._checkIfReloadNeeded(e.isPartial,this.props.isPartial)},n.componentWillUnmount=function(){this._stopPolling()},n._checkIfReloadNeeded=function(e,t){var n=this.props.dispatch;e!==t&&(!e&&t?this.polling=setInterval((function(){n(Object(m.u)())}),3e3):e&&!t&&this._stopPolling())},n._stopPolling=function(){this.polling&&(clearInterval(this.polling),this.polling=null)},n.render=function(){var e=this.props,t=e.intl,n=e.shouldUpdateScroll,a=e.hasUnread,o=e.columnId,i=e.multiColumn,s=e.hasAnnouncements,c=e.unreadAnnouncements,u=e.showAnnouncements,d=!!o,m=null;return s&&(m=Object(r.a)("button",{className:z()("column-header__button",{active:u}),title:t.formatMessage(u?ie.hide_announcements:ie.show_announcements),"aria-label":t.formatMessage(u?ie.hide_announcements:ie.show_announcements),"aria-pressed":u?"true":"false",onClick:this.handleToggleAnnouncementsClick},void 0,Object(r.a)(oe.a,{id:"bullhorn",count:c}))),l.a.createElement(h.a,{bindToDocument:!i,ref:this.setRef,label:t.formatMessage(ie.title)},Object(r.a)(g.a,{icon:"home",additionalClass:"home-timeline",active:a,title:t.formatMessage(ie.title),onPin:this.handlePin,onMove:this.handleMove,onClick:this.handleHeaderClick,pinned:d,multiColumn:i,extraButton:m,appendContent:s&&u&&Object(r.a)(ae,{})},void 0,Object(r.a)(_,{})),Object(r.a)(p.a,{trackScroll:!d,scrollKey:"home_timeline-"+o,onLoadMore:this.handleLoadMore,timelineId:"home",emptyMessage:Object(r.a)(v.b,{id:"empty_column.home",defaultMessage:"Your home timeline is empty! Follow more people to fill it up. {suggestions}",values:{suggestions:Object(r.a)(y.a,{to:"/start"},void 0,Object(r.a)(v.b,{id:"empty_column.home.suggestions",defaultMessage:"See some suggestions"}))}}),shouldUpdateScroll:n,bindToDocument:!i}))},t}(l.a.PureComponent))||Z)||Z}}]);
//# sourceMappingURL=home_timeline-15b534745b505de49714.chunk.js.map