(window.webpackJsonp=window.webpackJsonp||[]).push([[136],{802:function(e,t,n){"use strict";n.r(t);var r=n(69),o=n.n(r),a=n(133);function c(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return i(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function s(e){for(var t="==".slice(0,(4-e.length%4)%4),n=e.replace(/-/g,"+").replace(/_/g,"/")+t,r=atob(n),o=new ArrayBuffer(r.length),a=new Uint8Array(o),c=0;c<r.length;c++)a[c]=r.charCodeAt(c);return o}function u(e){for(var t,n="",r=c(new Uint8Array(e));!(t=r()).done;){var o=t.value;n+=String.fromCharCode(o)}return btoa(n).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function l(e,t,n){if("copy"===t)return n;if("convert"===t)return e(n);if(t instanceof Array)return n.map((function(n){return l(e,t[0],n)}));if(t instanceof Object){for(var r={},o=0,a=Object.entries(t);o<a.length;o++){var c=a[o],i=c[0],s=c[1];if(i in n)null!=n[i]?r[i]=l(e,s.schema,n[i]):r[i]=null;else if(s.required)throw new Error("Missing key: "+i)}return r}}function d(e){return{required:!0,schema:e}}function p(e){return{required:!1,schema:e}}var y={type:d("copy"),id:d("convert"),transports:p("copy")},f={appid:p("copy"),appidExclude:p("copy"),credProps:p("copy")},m={appid:p("copy"),appidExclude:p("copy"),credProps:p("copy")},g={publicKey:d({rp:d("copy"),user:d({id:d("convert"),name:d("copy"),displayName:d("copy")}),challenge:d("convert"),pubKeyCredParams:d("copy"),timeout:p("copy"),excludeCredentials:p([y]),authenticatorSelection:p("copy"),attestation:p("copy"),extensions:p(f)}),signal:p("copy")},v={type:d("copy"),id:d("copy"),rawId:d("convert"),response:d({clientDataJSON:d("convert"),attestationObject:d("convert")}),clientExtensionResults:d(m)},h={mediation:p("copy"),publicKey:d({challenge:d("convert"),timeout:p("copy"),rpId:p("copy"),allowCredentials:p([y]),userVerification:p("copy"),extensions:p(f)}),signal:p("copy")},b={type:d("copy"),id:d("copy"),rawId:d("convert"),response:d({clientDataJSON:d("convert"),authenticatorData:d("convert"),signature:d("convert"),userHandle:d("convert")}),clientExtensionResults:d(m)};function w(){return(w=Object(a.a)(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=function(e){var t=e;return t.clientExtensionResults=e.getClientExtensionResults(),l(u,v,t)},e.next=3,navigator.credentials.create(function(e){return l(s,g,e)}(t));case 3:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function E(){return(E=Object(a.a)(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=function(e){var t=e;return t.clientExtensionResults=e.getClientExtensionResults(),l(u,b,t)},e.next=3,navigator.credentials.get(function(e){return l(s,h,e)}(t));case 3:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var k=n(46);n(545);function x(){Array.from(document.getElementsByClassName("flash-message")).forEach((function(e){e.classList.add("hidden")}))}function I(e,t){var n;o.a.post(e,JSON.stringify(t),{headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-Token":(n=document.querySelector('meta[name="csrf-token"]'),n?n.getAttribute("content"):null)},credentials:"same-origin"}).then((function(e){window.location.replace(e.data.redirect_path)})).catch((function(e){422===e.response.status?(document.getElementById("security-key-error-message").classList.remove("hidden"),console.error(e.response.data.error)):console.error(e)}))}Object(k.default)((function(){if(!(navigator.credentials&&navigator.credentials.create&&navigator.credentials.get&&window.PublicKeyCredential)){var e=document.getElementById("unsupported-browser-message");e&&(e.classList.remove("hidden"),document.querySelector(".btn.js-webauthn").disabled=!0)}var t=document.getElementById("new_webauthn_credential");t&&t.addEventListener("submit",(function(e){e.preventDefault();var t=e.target.querySelector('input[name="new_webauthn_credential[nickname]"]');t.value?o.a.get("/settings/security_keys/options").then((function(e){(function(e){return w.apply(this,arguments)})({publicKey:e.data}).then((function(e){I("/settings/security_keys",{credential:e,nickname:t.value})})).catch((function(e){document.getElementById("security-key-error-message").classList.remove("hidden"),console.error(e)}))})).catch((function(e){console.error(e.response.data.error)})):t.focus()}));var n=document.getElementById("webauthn-form");if(n){n.addEventListener("submit",(function(e){e.preventDefault(),o.a.get("sessions/security_key_options").then((function(e){(function(e){return E.apply(this,arguments)})({publicKey:e.data}).then((function(e){I("sign_in",{user:{credential:e}})})).catch((function(e){document.getElementById("security-key-error-message").classList.remove("hidden"),console.error(e)}))})).catch((function(e){console.error(e.response.data.error)}))}));var r=document.getElementById("otp-authentication-form");document.getElementById("link-to-otp").addEventListener("click",(function(){n.classList.add("hidden"),r.classList.remove("hidden"),x()})),document.getElementById("link-to-webauthn").addEventListener("click",(function(){r.classList.add("hidden"),n.classList.remove("hidden"),x()}))}}))}},[[802,0]]]);
//# sourceMappingURL=two_factor_authentication-b9dc1a9e6e1b290a8068.chunk.js.map